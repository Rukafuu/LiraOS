datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider        = "prisma-client-js"
}

model User {
  id            String    @id
  email         String    @unique
  username      String
  passwordHash  String    @map("password_hash")
  passwordSalt  String?   @map("password_salt")
  avatar        String?
  createdAt     BigInt    @map("created_at")
  lastLogin     BigInt?   @default(0) @map("last_login")
  loginCount    Int?      @default(0) @map("login_count")
  preferencesStr String? @map("preferences")
  warnings      Int?      @default(0)
  isBanned      Int?      @default(0) @map("is_banned")
  plan          String?   @default("free")
  discordId     String?   @unique
  googleRefreshToken String? @map("google_refresh_token")

  @@map("users")
}

model Session {
  id        String @id
  userId    String
  title     String
  personaId String?
  createdAt BigInt
  updatedAt BigInt
  messagesStr String @map("messages")

  @@map("sessions")
}

model Memory {
  id         String @id
  userId     String?
  content    String
  category   String
  priority   String
  createdAt  BigInt
  tagsStr    String @map("tags")
  importance Int?    @default(1)
  embedding  String?

  @@map("memories")
}

model RefreshToken {
  token     String  @id
  userId    String?
  createdAt BigInt?
  expiresAt BigInt?
  revoked   Int?    @default(0)

  @@map("refresh_tokens")
}

model RecoverCode {
  email     String
  code      String
  expiresAt BigInt?
  used      Int?    @default(0)

  @@unique([email, code], name: "email_code")
  @@map("recover_codes")
}

model Gamification {
  userId           String  @id
  xp               Int?    @default(0)
  coins            Int?    @default(100)
  level            Int?    @default(1)
  statsStr            String? @map("stats")
  unlockedThemesStr   String? @map("unlocked_themes")
  unlockedPersonasStr String? @map("unlocked_personas")
  achievementsStr     String? @map("achievements")
  activePersonaId  String?
  updatedAt        BigInt?

  @@map("gamification")
}

model Feedback {
  id        String  @id
  userId    String?
  feedback  String?
  type      String?
  rating    Int?
  contextStr String? @map("context")
  status    String? @default("new")
  createdAt BigInt?

  @@map("feedback")
}

model Knowledge {
  id        String  @id
  userId    String?
  name      String?
  type      String?
  language  String?
  size      Int?
  content   String?
  createdAt BigInt?

  @@map("knowledge")
}

model Infraction {
  id        Int     @id @default(autoincrement())
  userId    String?
  level     String?
  category  String?
  reason    String?
  timestamp BigInt?

  @@map("infractions")
}

model Ban {
  userId      String  @id
  status      String?
  until       BigInt?
  reason      String?
  lastUpdated BigInt?

  @@map("bans")
}

model AuditLog {
  id          Int     @id @default(autoincrement())
  eventId     String?
  userId      String?
  actionTaken String?
  category    String?
  contentHash String?
  excerpt     String?
  timestamp   BigInt?

  @@map("audit_logs")
}

model Appeal {
  id        String  @id
  userId    String?
  message   String?
  status    String? @default("pending")
  adminNote String?
  createdAt BigInt?
  updatedAt BigInt?

  @@map("appeals")
}

model IrisVideo {
  id           String  @id
  userId       String?
  videoUrl     String?
  thumbnailUrl String?
  prompt       String?
  model        String?
  aspectRatio  String?
  resolution   String?
  createdAt    BigInt?

  @@map("iris_videos")
}

model ImageJob {
  id        String   @id
  userId    String?
  prompt    String
  status    String
  result    String?  // Base64 or URL
  createdAt BigInt
  provider  String?
  error     String?
  progress  Int?     @default(0)

  @@map("image_jobs")
}
